name: Build Test (Email Enabled)

permissions:
  contents: read

on:
  workflow_dispatch:
    inputs:
      ref:
        description: "Branch or tag to test (develop, feature/x, v1.2.0)"
        required: true
        default: "develop"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout selected ref
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.ref }}

      - name: Determine release type
        id: rel
        run: |
          REF="${{ github.event.inputs.ref }}"
          if [[ "$REF" == "develop" ]]; then
            echo "type=alpha" >> $GITHUB_OUTPUT
          elif [[ "$REF" == feature/* ]]; then
            echo "type=feature" >> $GITHUB_OUTPUT
          elif [[ "$REF" == v* ]]; then
            echo "type=production" >> $GITHUB_OUTPUT
          else
            echo "type=dev" >> $GITHUB_OUTPUT
          fi

      - name: Build test (email on success/failure)
        run: |
          make \
            GIT_REF=${{ github.event.inputs.ref }} \
            COMMIT_SHA=$(git rev-parse HEAD) \
            RELEASE_TYPE=${{ steps.rel.outputs.type }}
